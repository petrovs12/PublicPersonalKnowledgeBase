<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/PublicPersonalKnowledgeBase/favicon.ico"/><title>Scoreboard</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="Scoreboard"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://petrovs12.github.io/PublicPersonalKnowledgeBase/notes/7Jd2ym5CmQjaalbIJ4nYj/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="1/26/2022"/><meta property="article:modified_time" content="1/26/2022"/><link rel="canonical" href="https://petrovs12.github.io/PublicPersonalKnowledgeBase/notes/7Jd2ym5CmQjaalbIJ4nYj/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/PublicPersonalKnowledgeBase/_next/static/css/7719b08cc3352912.css" as="style"/><link rel="stylesheet" href="/PublicPersonalKnowledgeBase/_next/static/css/7719b08cc3352912.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/PublicPersonalKnowledgeBase/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/PublicPersonalKnowledgeBase/_next/static/chunks/webpack-b320c149a25b986a.js" defer=""></script><script src="/PublicPersonalKnowledgeBase/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/PublicPersonalKnowledgeBase/_next/static/chunks/main-8915ee191b7710e8.js" defer=""></script><script src="/PublicPersonalKnowledgeBase/_next/static/chunks/pages/_app-bf98b80149ea852b.js" defer=""></script><script src="/PublicPersonalKnowledgeBase/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/PublicPersonalKnowledgeBase/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/PublicPersonalKnowledgeBase/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/PublicPersonalKnowledgeBase/_next/static/d47oHCd-7QAOR5IvSuJke/_buildManifest.js" defer=""></script><script src="/PublicPersonalKnowledgeBase/_next/static/d47oHCd-7QAOR5IvSuJke/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="scoreboard">Scoreboard<a aria-hidden="true" class="anchor-heading icon-link" href="#scoreboard"></a></h1>
<p>We can:</p>
<ol>
<li>For each user, keep bucket_id, and score. </li>
<li>For each bucket, keep bucket_id, user_id, lower_bound,upper_bound, score, next and previous bucket pointers. </li>
<li>The ranking table is split into buckets.</li>
<li>When the user score is updates, we:</li>
</ol>
<ul>
<li>
<p>update the user score</p>
</li>
<li>
<p>check if we're still in the same bucket, else delete user from bucket, go up or down bucket pointers, and add user to new bucket. Alternatively, we can first consult a the bucket table above, and we can figure out the appropriate new bucket .</p>
</li>
<li>
<p>evern 100 ms, sort each bucket in parallel, using insertion sort. If we detect some buckets have too many inversions,
can switch them to merge sort (too many games in a given bracket).</p>
</li>
<li>
<p>if sorting time for any bucket becomes too large (>e.g. 50ms), then split the bucket into two,
move upper part of the user range to new bucket.</p>
</li>
<li>
<p>We retrieve 10 above and bellow you in the same bucket. For edge cases where  you're the top/bottom 9 person in bucket- have 2 parallel 'bucket' sequences: e.g. percentiles 0,2,...,98,100, and percentiles 0,1,3,5,...,99,100, search for user in both sequences. At least  1 of them will contain the -10-user_rank;10 +user_rank interval completely (or can use the bucket pointers, mentioned before)</p>
</li>
<li>
<p>For sorting the friend list: </p>
</li>
</ul>
<ol>
<li>
<p>If friend list is undirected, maintain these equivalence relations sort and retrieve them
Then we use similar sorting mechanisms for each friend list.
Friend lists are equivalence relationships, every time a user plays a game, update their score, use a procedure as above.</p>
</li>
<li>
<p>If friend list is directed
Maintain list to show to each user.</p>
</li>
</ol>
<p>For players with not many incoming friends (ppl who follow them):
Every such player is a pub-sub topic, to which ppl who follow them subscribe.
Then when game happens, the user publishes to the topic, and the topic publishes to all the users who follow it,
updating their 'friend' scoreboard w/ insertion sort.</p>
<p>For players with many incoming friends (ppl who follow them) :
Celebrity problem
Don't update follower scoreboard directly, but for each user, maintain a special list of celebrities they follow, and at
request- time, if there was update, insertion-sort them into the existing 'friend' scoreboards. </p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"7Jd2ym5CmQjaalbIJ4nYj","title":"Scoreboard","desc":"","updated":1643220747617,"created":1643216594659,"custom":{},"fname":"engineering.system_design.Scoreboard","type":"note","vault":{"fsPath":"vault"},"contentHash":"65e1dcc9bee513a1f58c404675c2c5f1","links":[],"anchors":{},"children":[],"parent":"gImPQvOVGCsqgPnkpuVfC","data":{}},"body":"\u003ch1 id=\"scoreboard\"\u003eScoreboard\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#scoreboard\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eWe can:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eFor each user, keep bucket_id, and score. \u003c/li\u003e\n\u003cli\u003eFor each bucket, keep bucket_id, user_id, lower_bound,upper_bound, score, next and previous bucket pointers. \u003c/li\u003e\n\u003cli\u003eThe ranking table is split into buckets.\u003c/li\u003e\n\u003cli\u003eWhen the user score is updates, we:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eupdate the user score\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003echeck if we're still in the same bucket, else delete user from bucket, go up or down bucket pointers, and add user to new bucket. Alternatively, we can first consult a the bucket table above, and we can figure out the appropriate new bucket .\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eevern 100 ms, sort each bucket in parallel, using insertion sort. If we detect some buckets have too many inversions,\ncan switch them to merge sort (too many games in a given bracket).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eif sorting time for any bucket becomes too large (\u003ee.g. 50ms), then split the bucket into two,\nmove upper part of the user range to new bucket.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eWe retrieve 10 above and bellow you in the same bucket. For edge cases where  you're the top/bottom 9 person in bucket- have 2 parallel 'bucket' sequences: e.g. percentiles 0,2,...,98,100, and percentiles 0,1,3,5,...,99,100, search for user in both sequences. At least  1 of them will contain the -10-user_rank;10 +user_rank interval completely (or can use the bucket pointers, mentioned before)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eFor sorting the friend list: \u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eIf friend list is undirected, maintain these equivalence relations sort and retrieve them\nThen we use similar sorting mechanisms for each friend list.\nFriend lists are equivalence relationships, every time a user plays a game, update their score, use a procedure as above.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIf friend list is directed\nMaintain list to show to each user.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eFor players with not many incoming friends (ppl who follow them):\nEvery such player is a pub-sub topic, to which ppl who follow them subscribe.\nThen when game happens, the user publishes to the topic, and the topic publishes to all the users who follow it,\nupdating their 'friend' scoreboard w/ insertion sort.\u003c/p\u003e\n\u003cp\u003eFor players with many incoming friends (ppl who follow them) :\nCelebrity problem\nDon't update follower scoreboard directly, but for each user, maintain a special list of celebrities they follow, and at\nrequest- time, if there was update, insertion-sort them into the existing 'friend' scoreboards. \u003c/p\u003e","noteIndex":{"id":"wn8PE1RhG0znK1alrGFYv","title":"Root","desc":"","updated":1647507231129,"created":1631901573363,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"db285659ccac8b133c384de1ef51de66","links":[],"anchors":{"welcome-to-stefans-notes":{"type":"header","text":"Welcome to Stefan's Notes!","value":"welcome-to-stefans-notes","line":7,"column":0,"depth":1}},"children":["mxzxxu8z4e6krz99ht96y9d","W1EOZ27Tqx6RbiA2aW3DI","DyoLE2kwm9rRfRZhBGxPW","idhfogizmtcmvaamtalp3o3","4w8wBCSRvYUnGIZeozW03","vB321AipYCs6ldVC0APs9","h6WVdl1UTWVXeWuMJSZ1f","bth6m0exy9q9loxib1mc4al","4abAmH56ausbldEJbZokx","JyOFJ5NTPSVWMfiDy951X","0OO7fjCpcaGZg5qDRZr8z","138666663","pohXgII67dAxnoufG7yAP","6hs48bnjnaoxahk07exj74u","42r6290iqzLPmg9BY7fIp","3hoLerNJHjNkDziIKlFF2","T6meT3UNw0nRorEbzoPSl","hIOTXIIBj3vmhG1xc91lA","tnFlQuOAGPkbU2fZI7Cb1","Jb3w3f4x8kixLhrjUW6S1","LV6q5jlD2xtCF6yYFEqFC","ENDcCZFjAW9h66eDoFg7I","b5IeREnsTbeggC7rmWV0p","2hmbhdzcdljtdwln762gcrv","z9la6u9t3xueldj2omf2gc6","9akeo93l6b026jmu4t6e7pw","sc24o4jglr9jg29qr5v0e44","0mt5ao8tbbz3z5mdwe0aer8","r7rvb6nal69nfb6ogqdadnm","xujx5iuxskj10o0ajpi109n","lyl1rzqz6zwcswpwh0kafrm","skpw697vlqdq3t3uqxpq5e3","a4tts3oc3oms7wuralrbzdc","13a1ufqh6o8yi9evw1u5kv5"],"parent":null,"data":{},"body":"# Welcome to Stefan's Notes!\n\n        \n\nLast updated: 2021.12.30\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"dendronVersion":"0.95.0","enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false,"templateHierarchy":"template"},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","assetsPrefix":"/PublicPersonalKnowledgeBase","siteUrl":"https://petrovs12.github.io","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"theme":"light","templateVersion":"0.97.0","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"7Jd2ym5CmQjaalbIJ4nYj"},"buildId":"d47oHCd-7QAOR5IvSuJke","assetPrefix":"/PublicPersonalKnowledgeBase","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>