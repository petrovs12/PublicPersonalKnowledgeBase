{"pageProps":{"note":{"id":"8po23yqsof1hx8vx1xm4uhv","title":"KATS","desc":"","updated":1657781188540,"created":1657742582796,"custom":{},"fname":"science.stats.Time Series.KATS","type":"note","vault":{"fsPath":"vault"},"contentHash":"a561a816e04320f243747177fe2e1e4d","links":[],"anchors":{"timeseriesdata--obbject":{"type":"header","text":"TimeSeriesData  obbject","value":"timeseriesdata--obbject","line":9,"column":0,"depth":1},"forecasting-with-kats":{"type":"header","text":"Forecasting with KATS","value":"forecasting-with-kats","line":16,"column":0,"depth":1},"httpsfacebookresearchgithubiokatsapi_moduleskatsmodelslstmhtmllstmmodelpredict":{"type":"header","text":"https://facebookresearch.github.io/Kats/api/_modules/kats/models/lstm.html#LSTMModel.predict","value":"httpsfacebookresearchgithubiokatsapi_moduleskatsmodelslstmhtmllstmmodelpredict","line":35,"column":0,"depth":1},"kats-backtestershttpsfacebookresearchgithubiokatsapikatsutilsbacktestershtml":{"type":"header","text":"(KATS Backtesters)https://facebookresearch.github.io/Kats/api/kats.utils.backtesters.html","value":"kats-backtestershttpsfacebookresearchgithubiokatsapikatsutilsbacktestershtml","line":41,"column":0,"depth":1},"inferring-frequency":{"type":"header","text":"Inferring frequency","value":"inferring-frequency","line":52,"column":0,"depth":1},"nb--use-cross-validation":{"type":"header","text":"NB : Use Cross Validation","value":"nb--use-cross-validation","line":58,"column":0,"depth":1},"kats---out-of-sample-step-ahead-forecasting":{"type":"header","text":"KATS - out of sample step-ahead forecasting","value":"kats---out-of-sample-step-ahead-forecasting","line":63,"column":0,"depth":1},"kats-prophet":{"type":"header","text":"KATS Prophet","value":"kats-prophet","line":71,"column":0,"depth":1},"low-hanging-fruit":{"type":"header","text":"Low-hanging fruit..","value":"low-hanging-fruit","line":97,"column":0,"depth":1},"general":{"type":"header","text":"General","value":"general","line":101,"column":0,"depth":2},"of-days-since-the-start-of-last-lockdown":{"type":"header","text":"of days since the start of last lockdown.","value":"of-days-since-the-start-of-last-lockdown","line":108,"column":0,"depth":1},"solving-the-bad-observational-periods-issue":{"type":"header","text":"Solving the 'bad observational periods' issue","value":"solving-the-bad-observational-periods-issue","line":116,"column":0,"depth":1},"event-and-holiday-modeling":{"type":"header","text":"Event and Holiday Modeling","value":"event-and-holiday-modeling","line":123,"column":0,"depth":2},"external-regressors-w-lstm":{"type":"header","text":"External regressors w/ LSTM","value":"external-regressors-w-lstm","line":126,"column":0,"depth":2},"split-and-aggregate":{"type":"header","text":"Split and aggregate","value":"split-and-aggregate","line":131,"column":0,"depth":2}},"children":[],"parent":"9g50kaYv8jpHHgyrpKHyF","data":{}},"body":"<h1 id=\"kats\">KATS<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#kats\"></a></h1>\n<h1 id=\"timeseriesdata--obbject\">TimeSeriesData  obbject<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#timeseriesdata--obbject\"></a></h1>\n<p>like ts in R, or mts in R.\njust a pandas dataframe with some additional stuff. </p>\n<p>Can convert from and to a pandas DF</p>\n<h1 id=\"forecasting-with-kats\">Forecasting with KATS<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#forecasting-with-kats\"></a></h1>\n<p>10 Basic forecasting models</p>\n<ol>\n<li>Linear</li>\n<li>Quadratic</li>\n<li>ARIMA</li>\n<li>SARIMA</li>\n<li>Holt-Winters</li>\n<li>Prophet</li>\n<li>AR-Net</li>\n<li>LSTM</li>\n<li>Theta</li>\n<li>VAR</li>\n</ol>\n<p>  -- Not obvious how to do\nk-step ahead out of sample predictions with KATS.</p>\n<h1 id=\"httpsfacebookresearchgithubiokatsapi_moduleskatsmodelslstmhtmllstmmodelpredict\"><a href=\"https://facebookresearch.github.io/Kats/api/_modules/kats/models/lstm.html#LSTMModel.predict\">https://facebookresearch.github.io/Kats/api/_modules/kats/models/lstm.html#LSTMModel.predict</a><a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#httpsfacebookresearchgithubiokatsapi_moduleskatsmodelslstmhtmllstmmodelpredict\"></a></h1>\n<p>However, BackTester is a way to do this...</p>\n<h1 id=\"kats-backtestershttpsfacebookresearchgithubiokatsapikatsutilsbacktestershtml\">(KATS Backtesters)[https://facebookresearch.github.io/Kats/api/kats.utils.backtesters.html]<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#kats-backtestershttpsfacebookresearchgithubiokatsapikatsutilsbacktestershtml\"></a></h1>\n<p>The <strong>frequency</strong> parameter is usually in the 'fit' function.</p>\n<p>Probably kwargs in the Backtest model are passed to the 'fit' model, or maybe the 'predict' function.</p>\n<p>Actually kwargs is just passed to the parent class constructor.</p>\n<p> I think it's pased to both, maybe...</p>\n<h1 id=\"inferring-frequency\">Inferring frequency<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#inferring-frequency\"></a></h1>\n<p> Kats uses <a href=\"/PublicPersonalKnowledgeBase/\">pandas infer freq function</a>\n<a href=\"https://pandas.pydata.org/docs/reference/api/pandas.infer_freq.html\">https://pandas.pydata.org/docs/reference/api/pandas.infer_freq.html</a></p>\n<h1 id=\"nb--use-cross-validation\">NB : Use Cross Validation<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#nb--use-cross-validation\"></a></h1>\n<p>rolling vs expanding window, etc...</p>\n<h1 id=\"kats---out-of-sample-step-ahead-forecasting\">KATS - out of sample step-ahead forecasting<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#kats---out-of-sample-step-ahead-forecasting\"></a></h1>\n<p><a href=\"https://facebookresearch.github.io/Kats/api/kats.models.arima.html\">https://facebookresearch.github.io/Kats/api/kats.models.arima.html</a></p>\n<p>Here inthe arima, there are <strong>start_params</strong>, and iteration limit...</p>\n<h1 id=\"kats-prophet\">KATS Prophet<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#kats-prophet\"></a></h1>\n<p>In the ProphetParams, there is somethign about holidays...</p>\n<p>There is a <a href=\"/PublicPersonalKnowledgeBase/httpshttps://github.com/facebookresearch/Kats/pull/129\">PR request</a> for this..</p>\n<p>From <a href=\"https://bytemeta.vip/repo/facebookresearch/Kats/issues/167\">here</a></p>\n<pre class=\"language-{python}\"><code class=\"language-{python}\">from kats.models.prophet import ProphetModel, ProphetParams\n\nair_passengers_ts = TimeSeriesData(air_passengers_df) reg = np.random.randn(len(air_passengers_ts))\n\npparams = ProphetParams(extra_regressors = [{'value': reg, 'name':'reg1'}])\n\npmodel = ProphetModel(data=air_passengers_ts, params=pparams)\n\npmodel.fit()\n\npmodel.predict(steps=20, extra_regressors = [{'value': np.random.randn(20), 'name':'reg1'}])`\n</code></pre>\n<h1 id=\"low-hanging-fruit\">Low-hanging fruit..<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#low-hanging-fruit\"></a></h1>\n<h2 id=\"general\">General<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#general\"></a></h2>\n<ol start=\"0\">\n<li>Use log1p -> exp(x)-1  to avoid predictions bellow 0...</li>\n<li>Featurization:\nUse Patrons forecast as a feature in a regression/auto-regressive model\nMoving averages over different time windows:\nPrevious 3 working days, mean and median for last week month, quarter, same quarter last year, a same week last year (if available).\n1/ (#days after last holiday). #days since the start of the semester and until the end of the semester.</li>\n</ol>\n<h1 id=\"of-days-since-the-start-of-last-lockdown\">of days since the start of last lockdown.<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#of-days-since-the-start-of-last-lockdown\"></a></h1>\n<p>Using patrons forecast for that date (as a version of a model stacking).</p>\n<p> -- Observation weights not included in Prophet At the moment</p>\n<ul>\n<li>Use Arima as Baseline model</li>\n</ul>\n<h1 id=\"solving-the-bad-observational-periods-issue\">Solving the 'bad observational periods' issue<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#solving-the-bad-observational-periods-issue\"></a></h1>\n<ol>\n<li>for each time series, fit <a href=\"https://scikit-learn.org/stable/modules/mixture.html\">Gaussian Mixture model</a> to check for 'abnormal periods'. Alternatively, they may be defined manually.</li>\n<li>For each time series, mark the 'abnormal' periods that have mean &#x3C;=1/3 of the mean of the cluster of largest values, as missing/NaN.</li>\n<li>Inpute the NaN's with <a href=\"https://pypi.org/project/autoimpute/\">https://pypi.org/project/autoimpute/</a>, spline feature.</li>\n</ol>\n<h2 id=\"event-and-holiday-modeling\">Event and Holiday Modeling<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#event-and-holiday-modeling\"></a></h2>\n<p>Add events. For the prophet model, can do it directly in the prophet constructor.</p>\n<h2 id=\"external-regressors-w-lstm\">External regressors w/ LSTM<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#external-regressors-w-lstm\"></a></h2>\n<p>Add external regressors as an extension of the input vectors...\nShould be easy to also add the the out of sample several-steps ahead things.</p>\n<h2 id=\"split-and-aggregate\">Split and aggregate<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#split-and-aggregate\"></a></h2>\n<p>Notes from\n<a href=\"https://towardsdatascience.com/the-best-deep-learning-models-for-time-series-forecasting-690767bc63f0\">Best DL Learning MNodels for TS</a></p>\n<p>there is an implementation of N-Beats in darts</p>\n<p><a href=\"https://github.com/QData/spacetimeformer\">https://github.com/QData/spacetimeformer</a></p>","noteIndex":{"id":"wn8PE1RhG0znK1alrGFYv","title":"Root","desc":"","updated":1647507231129,"created":1631901573363,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"db285659ccac8b133c384de1ef51de66","links":[],"anchors":{"welcome-to-stefans-notes":{"type":"header","text":"Welcome to Stefan's Notes!","value":"welcome-to-stefans-notes","line":7,"column":0,"depth":1}},"children":["mxzxxu8z4e6krz99ht96y9d","W1EOZ27Tqx6RbiA2aW3DI","DyoLE2kwm9rRfRZhBGxPW","idhfogizmtcmvaamtalp3o3","4w8wBCSRvYUnGIZeozW03","vB321AipYCs6ldVC0APs9","h6WVdl1UTWVXeWuMJSZ1f","bth6m0exy9q9loxib1mc4al","4abAmH56ausbldEJbZokx","JyOFJ5NTPSVWMfiDy951X","0OO7fjCpcaGZg5qDRZr8z","138666663","pohXgII67dAxnoufG7yAP","6hs48bnjnaoxahk07exj74u","42r6290iqzLPmg9BY7fIp","3hoLerNJHjNkDziIKlFF2","T6meT3UNw0nRorEbzoPSl","hIOTXIIBj3vmhG1xc91lA","tnFlQuOAGPkbU2fZI7Cb1","Jb3w3f4x8kixLhrjUW6S1","LV6q5jlD2xtCF6yYFEqFC","ENDcCZFjAW9h66eDoFg7I","b5IeREnsTbeggC7rmWV0p","2hmbhdzcdljtdwln762gcrv","z9la6u9t3xueldj2omf2gc6","9akeo93l6b026jmu4t6e7pw","sc24o4jglr9jg29qr5v0e44","0mt5ao8tbbz3z5mdwe0aer8","r7rvb6nal69nfb6ogqdadnm","xujx5iuxskj10o0ajpi109n","lyl1rzqz6zwcswpwh0kafrm","skpw697vlqdq3t3uqxpq5e3","a4tts3oc3oms7wuralrbzdc","13a1ufqh6o8yi9evw1u5kv5"],"parent":null,"data":{},"body":"# Welcome to Stefan's Notes!\n\n        \n\nLast updated: 2021.12.30\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"dendronVersion":"0.95.0","enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false,"templateHierarchy":"template"},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","assetsPrefix":"/PublicPersonalKnowledgeBase","siteUrl":"https://petrovs12.github.io","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"theme":"light","templateVersion":"0.97.0","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}