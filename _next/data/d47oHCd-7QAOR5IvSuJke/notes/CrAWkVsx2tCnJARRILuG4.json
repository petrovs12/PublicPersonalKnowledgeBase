{"pageProps":{"note":{"id":"CrAWkVsx2tCnJARRILuG4","title":"Doordash Talk","desc":"","updated":1644775346263,"created":1644531139053,"custom":{},"fname":"engineering.system_design,,Ml System Design.Doordash Talk","type":"note","vault":{"fsPath":"vault"},"contentHash":"8e2f79851fb9acedbd10f18aec2f9aec","links":[{"type":"wiki","from":{"fname":"engineering.system_design,,Ml System Design.Doordash Talk","id":"CrAWkVsx2tCnJARRILuG4","vaultName":"vault"},"value":"seed.Product Management.Personas","position":{"start":{"line":33,"column":1,"offset":725},"end":{"line":33,"column":37,"offset":761},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"seed.Product Management.Personas"}},{"type":"wiki","from":{"fname":"engineering.system_design,,Ml System Design.Doordash Talk","id":"CrAWkVsx2tCnJARRILuG4","vaultName":"vault"},"value":"Feature Stores","position":{"start":{"line":94,"column":1,"offset":1814},"end":{"line":94,"column":19,"offset":1832},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"Feature Stores"}},{"type":"wiki","from":{"fname":"engineering.system_design,,Ml System Design.Doordash Talk","id":"CrAWkVsx2tCnJARRILuG4","vaultName":"vault"},"value":"science.stats.Distribution Drift","position":{"start":{"line":146,"column":1,"offset":2990},"end":{"line":146,"column":37,"offset":3026},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"science.stats.Distribution Drift"}},{"from":{"fname":"seed.Product Management.Personas","id":"5e3lyw7ea2a9fjxm4y3hlqp","vaultName":"vault"},"type":"backlink","position":{"start":{"line":87,"column":5,"offset":2123},"end":{"line":87,"column":77,"offset":2195},"indent":[]},"value":"engineering.system_design,,Ml System Design.Doordash Talk"}],"anchors":{"ml-systems":{"type":"header","text":"ML Systems","value":"ml-systems","line":20,"column":0,"depth":1},"doordash-overview":{"type":"header","text":"DoorDash overview","value":"doordash-overview","line":23,"column":0,"depth":2},"goals-of-users":{"type":"header","text":"Goals of users:","value":"goals-of-users","line":37,"column":0,"depth":3},"restaurants":{"type":"header","text":"Restaurants:","value":"restaurants","line":40,"column":0,"depth":3},"delivery-service":{"type":"header","text":"Delivery Service:","value":"delivery-service","line":43,"column":0,"depth":3},"users":{"type":"header","text":"Users:","value":"users","line":46,"column":0,"depth":3},"users-restaurants":{"type":"header","text":"Users-Restaurants:","value":"users-restaurants","line":51,"column":0,"depth":2},"merchants---drivers":{"type":"header","text":"Merchants - Drivers:","value":"merchants---drivers","line":54,"column":0,"depth":2},"merchants":{"type":"header","text":"Merchants:","value":"merchants","line":63,"column":0,"depth":1},"users-1":{"type":"header","text":"Users","value":"users-1","line":71,"column":0,"depth":1},"delivery-service-1":{"type":"header","text":"Delivery Service","value":"delivery-service-1","line":76,"column":0,"depth":1},"offline-batch-to-online-on-demand-axis":{"type":"header","text":"Offline (batch) to online (on-demand) axis","value":"offline-batch-to-online-on-demand-axis","line":83,"column":0,"depth":1},"training-pipeline":{"type":"header","text":"Training Pipeline","value":"training-pipeline","line":90,"column":0,"depth":1},"ml-performance-goals":{"type":"header","text":"ML Performance goals","value":"ml-performance-goals","line":105,"column":0,"depth":1},"debuggability-goals":{"type":"header","text":"Debuggability goals","value":"debuggability-goals","line":112,"column":0,"depth":1},"stefans-own-musings":{"type":"header","text":"Stefan's own musings","value":"stefans-own-musings","line":117,"column":0,"depth":1},"shadowing-models":{"type":"header","text":"Shadowing models","value":"shadowing-models","line":144,"column":0,"depth":2},"use-the-model-log-to-replay-stuff":{"type":"header","text":"Use the model log to replay stuff","value":"use-the-model-log-to-replay-stuff","line":148,"column":0,"depth":2},"use-log-for-monitoring":{"type":"header","text":"Use log for monitoring","value":"use-log-for-monitoring","line":151,"column":0,"depth":2},"use-log-to-train-new-models":{"type":"header","text":"Use log to train new models","value":"use-log-to-train-new-models","line":154,"column":0,"depth":2},"monitor":{"type":"header","text":"Monitor","value":"monitor","line":159,"column":0,"depth":1},"launching-new-models":{"type":"header","text":"Launching new models","value":"launching-new-models","line":166,"column":0,"depth":1},"data-preparation":{"type":"header","text":"Data Preparation","value":"data-preparation","line":180,"column":0,"depth":1},"^usergoals":{"type":"block","value":"usergoals","line":37,"column":20}},"children":[],"parent":"mR1xZlMX1ULyWEc6esPWa","data":{}},"body":"<h1 id=\"doordash-talk\">Doordash Talk<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#doordash-talk\"></a></h1>\n<p>from <img src=\"https://www.youtube.com/watch?v=sEZsIUBIhNk&#x26;list=PLmGsNPZGeM5D8fgr2scwe8wZih4SYB7Vt&#x26;ab_channel=InfoQ\"></p>\n<p>Real world ML systems:</p>\n<div class=\"mermaid\">\n  graph LR;\nA(Data Pipeline)-->B(Model Deployment/Management)-->C(Model Monitoring/Evaluation)\n</div>\n<p>Real world ML systems:\n10% algorithms\n90% ml systems</p>\n<p>How to return the focus to the algorithms:</p>\n<h1 id=\"ml-systems\">ML Systems<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#ml-systems\"></a></h1>\n<p>Robust tools + templatzize best practices</p>\n<h2 id=\"doordash-overview\">DoorDash overview<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#doordash-overview\"></a></h2>\n<ul>\n<li>Last mile on-demand logistics</li>\n<li>3 sided marketplace (users, restaurants, delivery service)</li>\n<li>1600 cities by end of 2018</li>\n</ul>\n<p>Technology company</p>\n<p>Connecting the 3-sided marketplace.</p>\n<p>Mostly restaurant delivery.</p>\n<p>100000+ resraurants.\n300000 delivery drivers.\n10^10^6 deliveries.</p>\n<h3 id=\"goals-of-users-\"><a aria-hidden=\"true\" class=\"block-anchor anchor-heading icon-link\" id=\"^usergoals\" href=\"#^usergoals\"></a>Goals of users: <a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#goals-of-users-\"></a></h3>\n<p><a href=\"/PublicPersonalKnowledgeBase/notes/5e3lyw7ea2a9fjxm4y3hlqp\">Personas</a></p>\n<h3 id=\"restaurants\">Restaurants:<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#restaurants\"></a></h3>\n<p>reach and revenie</p>\n<h3 id=\"delivery-service\">Delivery Service:<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#delivery-service\"></a></h3>\n<p>Flexibility and earnings</p>\n<h3 id=\"users\">Users:<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#users\"></a></h3>\n<p>Convenience and seleciton</p>\n<p>Between the above sides, there are multiple ml algorithms:</p>\n<h2 id=\"users-restaurants\">Users-Restaurants:<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#users-restaurants\"></a></h2>\n<p>Recyss- recommendation/personalization, search ranking, demand prediction.</p>\n<h2 id=\"merchants---drivers\">Merchants - Drivers:<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#merchants---drivers\"></a></h2>\n<p>Core dispatch algorithm\nHotspots\nBatching of orders/etc</p>\n<p>Seems like the usual VRP stuff...</p>\n<h1 id=\"merchants\">Merchants:<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#merchants\"></a></h1>\n<p>food prep time\nparking prediction\nselection intelligence (e.g. what things are ppl going to order, how to structure the menu maybe, etc..)\ncombine demand spikes etc</p>\n<h1 id=\"users-1\">Users<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#users-1\"></a></h1>\n<p>lifetime value\npromotions\naquisition</p>\n<h1 id=\"delivery-service-1\">Delivery Service<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#delivery-service-1\"></a></h1>\n<p>Supply calculation\nPay calculation (effort-based)\nIncentives</p>\n<h1 id=\"offline-batch-to-online-on-demand-axis\">Offline (batch) to online (on-demand) axis<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#offline-batch-to-online-on-demand-axis\"></a></h1>\n<p>reccomendation might be offline (in this case) so offline\ntime prediction -online\ndemand forecasting in the middle (multiple horizons).</p>\n<h1 id=\"training-pipeline\">Training Pipeline<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#training-pipeline\"></a></h1>\n<div class=\"mermaid\">\n  graph LR;\nF[Common Features Store]-->B\nA[(Data)]-->B(\"Features Extractor\")-->C(\"Model Training Jobs\")-->D[(Model Repo)]\n\n</div>\n<p><a title=\"Private\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\" class=\"private\">Feature Stores (Private)</a> are great/super important.</p>\n<p>They serve as a single source of truth, store embeddings etc.</p>\n<h1 id=\"ml-performance-goals\">ML Performance goals<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#ml-performance-goals\"></a></h1>\n<ul>\n<li>Accuracy SLAs</li>\n<li>System SLAs  (latency)</li>\n<li>Debuggability*</li>\n<li>Time to Ship </li>\n</ul>\n<h1 id=\"debuggability-goals\">Debuggability goals<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#debuggability-goals\"></a></h1>\n<p> If some model is giving weird results, what do you do? What tooling do you need so you can quickly decide if it's a data issue, model going stale issue, or something else? What</p>\n<h1 id=\"stefans-own-musings\">Stefan's own musings<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#stefans-own-musings\"></a></h1>\n<p>Let's have some such structure:</p>\n<div class=\"mermaid\">\n  graph LR;\n\nD[Model Repository]--model-->I\nA[Request]-->B[Load Balancer]--\"json_data{user_id:1,restaurant_id:2,type:parking,...,timestamp}\"-->C[Predict]\nD[(Model Repository)]--Shadow Model-->I\n\nI[Model Service]-.-C\n\nF[(Feature Store)]--\"fetch data for entities, last entry&#x3C;=Timestamp\"-->C\nE[(Model Log)]\nG[(\"Model Metrics and Monitoring\")]\nE-.->G\nC--\"features, predictions\"-->E\n\nA1[Model Metadata]-.->D\nH[S3]--->D\n\n\n</div>\n<p>The model log holds all request, feature values, predictions, and outcomes</p>\n<h2 id=\"shadowing-models\">Shadowing models<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#shadowing-models\"></a></h2>\n<p>Run models in parallel, as well as on the different groups. Use the parallel models for counterfactual stuff.</p>\n<h2 id=\"use-the-model-log-to-replay-stuff\">Use the model log to replay stuff<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#use-the-model-log-to-replay-stuff\"></a></h2>\n<h2 id=\"use-log-for-monitoring\">Use log for monitoring<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#use-log-for-monitoring\"></a></h2>\n<p><a href=\"/PublicPersonalKnowledgeBase/notes/Zh0txnUCi8NGy872tQhGN\">Distribution Drift</a></p>\n<h2 id=\"use-log-to-train-new-models\">Use log to train new models<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#use-log-to-train-new-models\"></a></h2>\n<p>Thus making the training and prediction processes closer (modulo effect on customer behavior).</p>\n<h1 id=\"monitor\">Monitor<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#monitor\"></a></h1>\n<ul>\n<li>Feature Distributions</li>\n<li>Predictions</li>\n<li>Response times</li>\n</ul>\n<p>track summary stats, plot distributions, alert.</p>\n<h1 id=\"launching-new-models\">Launching new models<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#launching-new-models\"></a></h1>\n<p>Much faser now, as now the process is as follows:</p>\n<div class=\"mermaid\">\n  graph TD;\na[Model Ready]--\"Model Registry Knows how to serve model\"-->B[Register Model Metadata]\nB--\"Can test as shadow as a stage before AB test\"-->C\nC[\"Enable Shadow/experiment\"]-->D[Monitor Metrics]\n\n\n\n</div>\n<h1 id=\"data-preparation\">Data Preparation<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#data-preparation\"></a></h1>\n<p>While doing data prep, it would be ideal to integrate with the feature store.</p>\n<hr>\n<strong>Backlinks</strong>\n<ul>\n<li><a href=\"/PublicPersonalKnowledgeBase/notes/5e3lyw7ea2a9fjxm4y3hlqp\">Personas</a></li>\n</ul>","noteIndex":{"id":"wn8PE1RhG0znK1alrGFYv","title":"Root","desc":"","updated":1647507231129,"created":1631901573363,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"db285659ccac8b133c384de1ef51de66","links":[],"anchors":{"welcome-to-stefans-notes":{"type":"header","text":"Welcome to Stefan's Notes!","value":"welcome-to-stefans-notes","line":7,"column":0,"depth":1}},"children":["mxzxxu8z4e6krz99ht96y9d","W1EOZ27Tqx6RbiA2aW3DI","DyoLE2kwm9rRfRZhBGxPW","idhfogizmtcmvaamtalp3o3","4w8wBCSRvYUnGIZeozW03","vB321AipYCs6ldVC0APs9","h6WVdl1UTWVXeWuMJSZ1f","bth6m0exy9q9loxib1mc4al","4abAmH56ausbldEJbZokx","JyOFJ5NTPSVWMfiDy951X","0OO7fjCpcaGZg5qDRZr8z","138666663","pohXgII67dAxnoufG7yAP","6hs48bnjnaoxahk07exj74u","42r6290iqzLPmg9BY7fIp","3hoLerNJHjNkDziIKlFF2","T6meT3UNw0nRorEbzoPSl","hIOTXIIBj3vmhG1xc91lA","tnFlQuOAGPkbU2fZI7Cb1","Jb3w3f4x8kixLhrjUW6S1","LV6q5jlD2xtCF6yYFEqFC","ENDcCZFjAW9h66eDoFg7I","b5IeREnsTbeggC7rmWV0p","2hmbhdzcdljtdwln762gcrv","z9la6u9t3xueldj2omf2gc6","9akeo93l6b026jmu4t6e7pw","sc24o4jglr9jg29qr5v0e44","0mt5ao8tbbz3z5mdwe0aer8","r7rvb6nal69nfb6ogqdadnm","xujx5iuxskj10o0ajpi109n","lyl1rzqz6zwcswpwh0kafrm","skpw697vlqdq3t3uqxpq5e3","a4tts3oc3oms7wuralrbzdc","13a1ufqh6o8yi9evw1u5kv5"],"parent":null,"data":{},"body":"# Welcome to Stefan's Notes!\n\n        \n\nLast updated: 2021.12.30\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"dendronVersion":"0.95.0","enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false,"templateHierarchy":"template"},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","assetsPrefix":"/PublicPersonalKnowledgeBase","siteUrl":"https://petrovs12.github.io","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"theme":"light","templateVersion":"0.97.0","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}